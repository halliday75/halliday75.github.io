<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AAC Web App</title>
<style>
body { font-family: Arial,sans-serif; background:#f4f9ff; margin:0; padding:15px; display:flex; flex-direction:column; align-items:center; }

#sentence-bar { display:flex; align-items:center; background:white; border-radius:16px; padding:15px; width:95%; max-width:1000px; box-shadow:0 4px 8px rgba(0,0,0,0.1); margin-bottom:15px; flex-wrap:wrap; }
#sentence-text { flex:1; font-size:24px; font-weight:bold; min-height:32px; margin-right:10px; }
#sentence-bar button { font-size:18px; margin:5px; padding:12px 18px; border:none; border-radius:12px; cursor:pointer; color:white; }
#speak-btn { background:#2a9d8f; }
#clear-btn { background:#f4a261; }
#stop-btn { background:#e63946; }
#mode-btn { background:#1d3557; }
#settings-toggle { background:#457b9d; }
#edit-toggle { background:#6a4c93; }

#settings-panel, #edit-panel { display:none; position:fixed; bottom:15px; left:50%; transform:translateX(-50%); background:white; border-radius:16px; padding:20px; width:90%; max-width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:10; }
#settings-panel h2, #edit-panel h2 { margin-top:0; font-size:20px; text-align:center; }

.container { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:20px; width:95%; max-width:1000px; }
.aac-btn { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:15px; background:white; border-radius:16px; box-shadow:0 4px 8px rgba(0,0,0,0.15); cursor:pointer; transition:transform 0.2s; position:relative; text-align:center; min-height:140px; font-size:20px; }
.aac-btn:hover { transform:scale(1.05); background:#eaf4ff; }
.aac-btn img { width:90px; height:90px; object-fit:contain; margin-bottom:8px; }
.aac-btn .large-text { font-size:36px; font-weight:bold; margin-bottom:6px; }

@media(max-width:600px){ 
  .container { grid-template-columns:1fr 1fr; }
  .aac-btn img { width:70px; height:70px; }
  .aac-btn .large-text { font-size:28px; }
}
</style>
</head>
<body>

<!-- Sentence Bar -->
<div id="sentence-bar">
  <div id="sentence-text"></div>
  <button id="speak-btn" onclick="speakSentence()">üîä Speak</button>
  <button id="clear-btn" onclick="clearSentence()">‚ùå Clear</button>
  <button id="stop-btn" onclick="stopSpeech()">üõë Stop</button>
  <button id="mode-btn" onclick="toggleMode()">üìù Mode: Sentence</button>
  <button id="settings-toggle" onclick="togglePanel('settings-panel')">‚öôÔ∏è</button>
  <button id="edit-toggle" onclick="togglePanel('edit-panel')">‚úèÔ∏è</button>
</div>

<!-- Settings Panel -->
<div id="settings-panel">
  <h2>Speech Settings</h2>
  <label>Voice: <select id="voiceSelect" onchange="saveSettings()"></select></label><br><br>
  <label>Rate: <input id="rateRange" type="range" min="0.5" max="2" step="0.1" value="1" onchange="saveSettings()"></label><br><br>
  <label>Pitch: <input id="pitchRange" type="range" min="0.5" max="2" step="0.1" value="1" onchange="saveSettings()"></label>
</div>

<!-- Edit Panel -->
<div id="edit-panel">
  <h2>Add New Button</h2>
  <input id="newWord" type="text" placeholder="Word to speak"><br><br>
  <input id="newLabel" type="text" placeholder="Label/emoji (optional)"><br><br>
  <input id="newImgUrl" type="url" placeholder="Image URL (optional)"><br><br>
  <input id="newFile" type="file" accept="image/*"><br><br>
  <button onclick="addNewButton()" style="background:#2a9d8f;color:white;padding:10px 15px;border:none;border-radius:8px;cursor:pointer;">‚ûï Add Button</button>
</div>

<!-- Buttons Grid -->
<div class="container" id="aac-container"></div>

<script>
const container = document.getElementById("aac-container");
const sentenceText = document.getElementById("sentence-text");
const voiceSelect = document.getElementById("voiceSelect");
const rateRange = document.getElementById("rateRange");
const pitchRange = document.getElementById("pitchRange");

let voices = [], sentence = [];

// Load buttons/settings from localStorage
let aacButtons = JSON.parse(localStorage.getItem("aac_buttons")) || [
  {word:"Hello", label:"üëã", img:null},
  {word:"I want", label:"‚úã", img:null},
  {word:"Food", label:"üçî", img:null},
  {word:"Water", label:"üíß", img:null},
  {word:"Bathroom", label:"üöΩ", img:null},
  {word:"Help", label:"üÜò", img:null}
];

let settings = JSON.parse(localStorage.getItem("aac_settings")) || {
  mode: "sentence",
  voiceIndex: 0,
  rate: 1,
  pitch: 1
};
let mode = settings.mode;

// Render AAC buttons
function renderButtons(){
  container.innerHTML="";
  aacButtons.forEach(btn=>{
    const div=document.createElement("div");
    div.className="aac-btn";
    if(btn.img){
      div.innerHTML = `<img src="${btn.img}" alt=""><span>${btn.word}</span>`;
    } else {
      div.innerHTML = `<div class="large-text">${btn.label || btn.word}</div><span>${btn.word}</span>`;
    }
    div.onclick=()=>{ if(mode==="sentence") addToSentence(btn.word); else speakWord(btn.word); };
    container.appendChild(div);
  });
}

// Sentence functions
function addToSentence(word){ sentence.push(word); sentenceText.textContent = sentence.join(" "); }
function clearSentence(){ sentence=[]; sentenceText.textContent = ""; }
function speakSentence(){
  if(!sentence.length) return;
  stopSpeech();
  const u=new SpeechSynthesisUtterance(sentence.join(" "));
  u.voice=voices[voiceSelect.selectedIndex]||null;
  u.rate=parseFloat(rateRange.value); u.pitch=parseFloat(pitchRange.value);
  window.speechSynthesis.speak(u);
}
function speakWord(word){
  stopSpeech();
  const u=new SpeechSynthesisUtterance(word);
  u.voice=voices[voiceSelect.selectedIndex]||null;
  u.rate=parseFloat(rateRange.value); u.pitch=parseFloat(pitchRange.value);
  window.speechSynthesis.speak(u);
}
function stopSpeech(){ if('speechSynthesis' in window) window.speechSynthesis.cancel(); }

// Mode toggle
function toggleMode(){ 
  mode=(mode==="sentence")?"on-demand":"sentence";
  document.getElementById("mode-btn").textContent=`üìù Mode: ${mode==="sentence"?"Sentence":"On-Demand"}`;
  settings.mode=mode; saveSettings();
}

// Panels
function togglePanel(id){ const el=document.getElementById(id); el.style.display=(el.style.display==="block")?"none":"block"; }

// Save/load settings
function saveSettings(){
  settings.voiceIndex = voiceSelect.selectedIndex;
  settings.rate = parseFloat(rateRange.value);
  settings.pitch = parseFloat(pitchRange.value);
  settings.mode = mode;
  localStorage.setItem("aac_settings", JSON.stringify(settings));
}

// Add new AAC button
function addNewButton(){
  const word=document.getElementById("newWord").value.trim();
  const label=document.getElementById("newLabel").value.trim();
  const url=document.getElementById("newImgUrl").value.trim();
  const file=document.getElementById("newFile").files[0];

  if(!word) return alert("Please enter a word to speak");

  if(file){
    const reader=new FileReader();
    reader.onload=e=>{
      aacButtons.push({word,label,img:e.target.result});
      saveButtons(); renderButtons();
    };
    reader.readAsDataURL(file);
  } else if(url){
    aacButtons.push({word,label,img:url});
    saveButtons(); renderButtons();
  } else {
    aacButtons.push({word,label:label || word,img:null});
    saveButtons(); renderButtons();
  }

  document.getElementById("newWord").value="";
  document.getElementById("newLabel").value="";
  document.getElementById("newImgUrl").value="";
  document.getElementById("newFile").value="";
}

function saveButtons(){ localStorage.setItem("aac_buttons", JSON.stringify(aacButtons)); }

// Load voices
function loadVoices(){
  if(!('speechSynthesis' in window)) return;
  voices=window.speechSynthesis.getVoices()||[];
  voiceSelect.innerHTML="";
  voices.forEach(v=>{
    const o=document.createElement("option");
    o.textContent=`${v.name} (${v.lang})`;
    voiceSelect.appendChild(o);
  });
  if(settings.voiceIndex<voices.length) voiceSelect.selectedIndex=settings.voiceIndex;
  rateRange.value=settings.rate;
  pitchRange.value=settings.pitch;
  toggleMode(); // apply saved mode
}

// Initialize
renderButtons();
loadVoices();
speechSynthesis.onvoiceschanged=loadVoices;
</script>
</body>
</html>
